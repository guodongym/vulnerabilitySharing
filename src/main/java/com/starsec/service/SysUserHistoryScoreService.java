package com.starsec.service;

import java.util.ArrayList;
import java.util.Calendar;
import java.util.List;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Service;

import com.starsec.dao.SysUserDao;
import com.starsec.dao.SysUserHistoryScoreDao;
import com.starsec.po.SysUser;
import com.starsec.po.SysUserHistoryScore;

/**
 *历史积分
 * @author cheng cheng
 *
 */
@Service
public class SysUserHistoryScoreService{
	//用户信息
	@Autowired
	private SysUserDao sysUserDao;
	//用户历史积分
	@Autowired
	private SysUserHistoryScoreDao sysUserHistoryScoreDao;
	/**
	 * 积分清零
	 * @return
	 */
	public boolean insertClearScore() {
	
		Calendar a=Calendar.getInstance();
		int year = a.get(Calendar.YEAR)-1;//得到年
		//获得所有用户信息
		List<SysUser> sysUserList = sysUserDao.getSysUserListByHQL();
		//历史积分信息list
		List<SysUserHistoryScore> sysUserHistoryScoreList = new ArrayList<SysUserHistoryScore>();
		//遍历所有用户信息
		for (SysUser sysUser : sysUserList) {
			SysUserHistoryScore sysuserHistoryScore = new SysUserHistoryScore();
			sysuserHistoryScore.setScore(sysUser.getTaskScore());
			sysuserHistoryScore.setSysUser(sysUser);
			sysuserHistoryScore.setYear(year);
			sysUserHistoryScoreList.add(sysuserHistoryScore);
		}
		//保存上一年的历史积分信息list
		Integer  isSaveSysUserHistoryScoreList=  sysUserHistoryScoreDao.saveSysUserHistoryScoreList(sysUserHistoryScoreList);
		boolean isUpadateSysUser = false;
		//如果保存历史积分信息list成功
		if(1==isSaveSysUserHistoryScoreList){
			//遍历所有用户信息
			for (SysUser sysUser : sysUserList) {
				sysUser.setTaskScore(0);
			}
			 isUpadateSysUser = sysUserDao.updateSysUserList(sysUserList);
		}
		
		return  isUpadateSysUser;
	}
	
	
}