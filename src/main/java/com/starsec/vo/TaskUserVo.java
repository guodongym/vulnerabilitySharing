package com.starsec.vo;

import java.util.Set;

import com.starsec.constants.TaskStatus;
import com.starsec.model.Vo;
import com.starsec.po.TaskUser;
import com.starsec.util.DateUtil;
import com.starsec.util.SessionUtil;

public class TaskUserVo implements Vo<TaskUser> {

	private Integer id;

	/** 任务ID */
	private Integer taskId;

	/** 任务名称 */
	private String taskName;

	/** 发布时间 */
	private String releaseTime;

	/** 任务状态 */
	private String taskStatus;

	/** 队员ID **/
	private Integer memberUserId;

	/** 队员name */
	private String memberUserAccount;

	/** 队长ID */
	private Integer leaderUserId;

	/** 队长name */
	private String leaderUserAccount;

	/** 是否为队长 */
	private boolean leader;

	/** 是否允许提交任务 **/
	private boolean submit;

	public Integer getId() {
		return id;
	}

	public void setId(Integer id) {
		this.id = id;
	}

	public Integer getTaskId() {
		return taskId;
	}

	public void setTaskId(Integer taskId) {
		this.taskId = taskId;
	}

	public String getTaskName() {
		return taskName;
	}

	public void setTaskName(String taskName) {
		this.taskName = taskName;
	}

	public String getReleaseTime() {
		return releaseTime;
	}

	public void setReleaseTime(String releaseTime) {
		this.releaseTime = releaseTime;
	}

	public String getTaskStatus() {
		return taskStatus;
	}

	public void setTaskStatus(String taskStatus) {
		this.taskStatus = taskStatus;
	}

	public Integer getLeaderUserId() {
		return leaderUserId;
	}

	public void setLeaderUserId(Integer leaderUserId) {
		this.leaderUserId = leaderUserId;
	}

	public String getLeaderUserAccount() {
		return leaderUserAccount;
	}

	public void setLeaderUserAccount(String leaderUserAccount) {
		this.leaderUserAccount = leaderUserAccount;
	}

	public boolean isLeader() {
		return leader;
	}

	public void setLeader(boolean leader) {
		this.leader = leader;
	}

	public boolean isSubmit() {
		return submit;
	}

	public void setSubmit(boolean submit) {
		this.submit = submit;
	}

	public Integer getMemberUserId() {
		return memberUserId;
	}

	public void setMemberUserId(Integer memberUserId) {
		this.memberUserId = memberUserId;
	}

	public String getMemberUserAccount() {
		return memberUserAccount;
	}

	public void setMemberUserAccount(String memberUserAccount) {
		this.memberUserAccount = memberUserAccount;
	}

	@Override
	public void from(TaskUser po) {
		setId(po.getId());
		setTaskId(po.getTask().getId());
		setTaskName(po.getTask().getTaskName());
		setTaskStatus(TaskStatus.valueOf(po.getTask().getStatus()).toString());
		setReleaseTime(DateUtil.formatDateTime(po.getTask().getReleaseTime()));

		setMemberUserId(po.getSysUser().getId());
		setMemberUserAccount(po.getSysUser().getUserAccount());
		
		Set<TaskUser> taskUsers = po.getTask().getTaskUsers();
		boolean isTransfer = false;
		for (TaskUser taskUser : taskUsers) {
			if (taskUser.isLeader()) {
				setLeaderUserId(taskUser.getSysUser().getId());
				setLeaderUserAccount(taskUser.getSysUser().getUserAccount());
				isTransfer = taskUser.isTransfer();
			}
		}

		setLeader(SessionUtil.loginUser().getId() == getLeaderUserId() && !isTransfer && po.getTask().getStatus() == TaskStatus.已发布.value());
		setSubmit(SessionUtil.loginUser().getId() == getLeaderUserId() && po.getTask().getStatus() == TaskStatus.已发布.value());
	}

}