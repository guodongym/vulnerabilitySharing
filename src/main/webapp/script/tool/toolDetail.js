/**
 * Created by kingsir on 16/7/26.
 */
$(document).ready(function () {
    var editor= new wangEditor('myComment');
    editor.config.menus=editorMenuConf;
    editor.config.uploadImgUrl=CTX+"/tool/uploadImage";
    editor.config.uploadImgFileName = 'imageFile';
    editor.config.hideLinkImg=true;
    editor.config.menuFixed=true;
    editor.config.printLog = false;
    editor.create();
    setTable();
    
    
    $("#submitComment").click(function(){
    	$.post(CTX+'/toolComment/save', {content:editor.$txt.html(),toolId : $("#toolId").val()}, function(data) {
    		if (!data.error) {
    			editor.$txt.html('<p><br></p>');
    			$('#comment_table').bootstrapTable('refresh');
    		} else {
    			swal(data.message);
    		}
    	});
    });
});

//渲染评论表格
function setTable(){
    var comment_table={
        columns:[{
            width:"10%",
            formatter:function(value,row,index){
                return '<div class="row"><a href="'+CTX+'/toUserInfo?userId='+row.commentUserId+'">\
                    <div class="col-xs-12">\
                    <img src="'+row.attachmentDownLoadPath+'" style="width: 100%">\
                    </div>\
                    <div class="col-xs-12 text-center">'+row.commentUserAccount+'</div></a>\
                    <div class="col-xs-12 text-center">'+row.commentTime+'</div>\
                    </div>';
            }
        },{
            field:"content",
            width:"90%"
        }],
        method: 'post',
	    contentType: "application/x-www-form-urlencoded",
	    url:CTX+"/toolComment/findCommentPage?toolId="+$("#toolId").val(),
		pagination: true,
	    pageList:[5, 10, 15, 20, 25],//可以选择一页显示 几行
		pageSize:5,//默认一页显示 几行
		pageNumber:1,//默认显示第几页
		sidePagination:'server',//设置为服务器端分页
		cache: false,
	    paginationPreText:"前一页",
	    paginationNextText:"后一页",
	    toolbarAlign:"right",
	    showHeader:false,
	    classes:"table table-bordered"
    }
    $('#comment_table').bootstrapTable(comment_table);
}