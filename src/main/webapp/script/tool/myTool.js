/**
 * Created by kingsir on 16/7/26.
 */

window.operateEvents = {
    //删除按钮点击事件
    'click .remove': function (e, value, row, index) {
    	swal({
    		title:"删除",
    		text: "您确定要删除么?",
    		type: "warning",
    		showCancelButton: true,
    		cancelButtonText:"取消",
    		CancelButtonColor: "#cccccc",
    		confirmButtonText: "确定",
    		closeOnConfirm: true
    	},function(){
    		$.post(CTX+'/tool/delete', {toolIds : row.toolId}, function(data) {
        		if (!data.error) {
                    swal({
                        title:"提示",
                        text: "删除成功",
                        type: "info",
                        showCancelButton: false,
                        confirmButtonText: "确定",
                        closeOnConfirm: true
                    },function(){
                        window.location.href=CTX+"/toMyTools";
                    })
        		} else {
        			swal(data.message);
        		}
        	});
    	});
    },
    //取消禁用按钮事件
    'click .release': function (e, value, row, index) {
    	//发布工具确认提示
    	swal({
    		title:"发布",
    		text: "您确定要发布么?",
    		type: "warning",
    		showCancelButton: true,
    		cancelButtonText:"取消",
    		CancelButtonColor: "#cccccc",
    		confirmButtonText: "确定",
    		closeOnConfirm: true
    	},function(){
    		$.post(CTX+'/tool/releaseTool', {toolId:row.toolId}, function(data) {
        		if (!data.error) {
                    swal({
                        title:"提示",
                        text: "发布成功",
                        type: "info",
                        showCancelButton: false,
                        confirmButtonText: "确定",
                        closeOnConfirm: true
                    },function(){
                        window.location.href=CTX+"/toMyTools";
                    })
        		} else {
        			swal(data.message);
        		}
        	});
    		
    	});   	
    }
};

$(document).ready(function(){
    var noReleaseColumns=[{
        field:"createTime",
        title:"创建时间",
        width:"15%"
    },{
        field:"toolName",
        title:"工具标题",
        width:"65%",
        formatter:function(value,row,index){
            return '<a href="'+CTX+'/tool/toolDetail?toolId='+row.toolId+'">'+row.toolName+'</a>'
        }
    },{
        field:"haddle",
        title:"操作",
        width:"20%",
        align:"center",
        formatter:function(value,row,index){
        	var haddle = "";
        	if(row.attachmentId == undefined){
        		haddle += '<span class="download" title="下载"><i class="glyphicon glyphicon-download-alt"></i></span>';
        	}else{
        		haddle += '<a class="download" href="'+CTX+'/attachment/download/'+row.attachmentId+'" title="下载"><i class="glyphicon glyphicon-download-alt"></i></a>';
        	}
        	
        	haddle += '<a class="release" href="javascript:void(0)" title="发布"><i class="glyphicon glyphicon-star-empty"></i></a>'+
                '<a class="update" href="'+CTX+'/tool/update?toolId='+ row.toolId +'" title="修改"><i class="glyphicon glyphicon-pencil"></i></a>'+
                '<a class="remove" href="javascript:void(0)" title="删除"><i class="glyphicon glyphicon-trash"></i></a>';
        	
            return haddle;
        },
        events:'operateEvents'
    }];
    var noReleaseTable=setTableConf(noReleaseColumns,"#toolbar1",CTX+"/tool/findNotReleasePage");
    $("#noReleaseTable").bootstrapTable(noReleaseTable);

    
    
    //我的已发布工具
    var releaseColumns=[{
        field:"createTime",
        title:"发布时间",
        width:"15%"
    },{
        field:"toolName",
        title:"工具标题",
        width:"65%",
        formatter:function(value,row,index){
            return '<a href="'+CTX+'/tool/toolDetail?toolId='+row.toolId+'">'+ row.toolName +'</a>'
        }
    },{
        field:"sumComment",
        title:"评论数",
        width:"10%",
        align:"center"
    },{
        field:"haddle",
        title:"操作",
        width:"10%",
        align:"center",
        formatter:function(value,row,index){
        	var haddle = "";
        	if(row.attachmentId == undefined){
        		haddle += '<span class="download" title="下载"><i class="glyphicon glyphicon-download-alt"></i></span>';
        	}else{
        		haddle += '<a class="download" href="'+CTX+'/attachment/download/'+row.attachmentId+'" title="下载"><i class="glyphicon glyphicon-download-alt"></i></a>';
        	}
        	return haddle;
        },
        events:'operateEvents'
    }];
    var releaseTable=setTableConf(releaseColumns,"#toolbar2",CTX+"/tool/findReleasePage");
    $("#releaseTable").bootstrapTable(releaseTable);

    //创建工具按钮事件
    $("button.ss").click(function(){
        location.href=CTX+"/toNewTool"
    });
});

//表格配置参数设置
function setTableConf(columns,toolbar,url){
    var conf={
    	columns:columns,
		method: 'post',
	    contentType: "application/x-www-form-urlencoded",
	    url:url,
		pagination: true,
	    pageList:[5, 10, 15, 20, 25],//可以选择一页显示 几行
		pageSize:5,//默认一页显示 几行
		pageNumber:1,//默认显示第几页
		sidePagination:'server',//设置为服务器端分页
		search: true,
		cache: false,
		showRefresh: true,//刷新按钮
		striped: true,//是否循环变色
	    paginationPreText:"前一页",
	    paginationNextText:"后一页",
	    toolbar:toolbar,
	    toolbarAlign:"right",
	    showPaginationSwitch:true
    }
    return conf;
}