/**
 * Created by kingsir on 16/7/25.
 */

var tool_table={
    columns:[{
        field:"createTime",
        title:"发布时间",
        width:"20%"
    },{
        field:"toolName",
        title:"工具标题",
        width:"40%",
        formatter:function(value,row,index){
            return '<a href="'+CTX+'/tool/toolDetail?toolId='+row.toolId+'">'+row.toolName+'</a>';
        }
    },{
        field:"sumComment",
        title:"评论数",
        width:"15%",
        align:"center",
    },{
        field:"submitUserAccount",
        title:"发布人",
        width:"15%",
        align:"center",
        formatter:function(value,row,index){
            return '<a href="'+CTX+'/toUserInfo?userID='+row.submitUserId+'">'+ row.submitUserAccount +'</a>';
        }
    },{
        field:"haddle",
        title:"操作",
        width:"10%",
        align:"center",
        formatter:function(value,row,index){
        	if(row.attachmentId == undefined){
        		return '<span class="release" title="下载"><i class="glyphicon glyphicon-download-alt"></i></span>';
        	}else{
        		return '<a class="release" href="'+CTX+'/attachment/download/'+row.attachmentId+'" title="下载"><i class="glyphicon glyphicon-download-alt"></i></a>';
        	}
        },
        events:'operateEvents'
    }],
    method: 'post',
    contentType: "application/x-www-form-urlencoded",
    url:CTX+'/tool/findPage',
	pagination: true,
    pageList:[5, 10, 15, 20, 25],//可以选择一页显示 几行
	pageSize:5,//默认一页显示 几行
	pageNumber:1,//默认显示第几页
	sidePagination:'server',//设置为服务器端分页
	search: true,
	cache: false,
	showRefresh: true,//刷新按钮
	striped: true,//是否循环变色
    paginationPreText:"前一页",
    paginationNextText:"后一页",
    toolbar:"#toolbar",
    toolbarAlign:"right",
    showPaginationSwitch:true
};
var table = $('#tool_table').bootstrapTable(tool_table);

$(document).ready(function(){
    var dateConf={
        format: 'yyyy-mm-dd',
        autoclose: true,
        startDate: "2016-07-01",
        startView:2,
        minView:2,
        maxView:4,
        language:"zh-CN",
        bootcssVer:3
    }
    setType();
    $("#createStartTime").datetimepicker(dateConf);
    $("#createEndTime").datetimepicker(dateConf);
   
    $("#submitToolSearch").click(function(){
    	$('#searchModal').modal('hide');
    	table.bootstrapTable('refresh',{
            query:{
            	search : '',
                likeKeyWord : $("#key").val(),
                toolTypeId : $("#type").val(),
                createStarTime : $("#createStartTime").val(),
                createEndTime : $("#createEndTime").val()
            }
        });

    });
    
});

function setType(){
	$.post(CTX+'/toolType/findAll', {}, function(data) {
		$("#type").append("<option value='0'>请选择</option>");
		for(var i=0;i<data.length;i++){
			$("#type").append("<option value="+ data[i].id +">"+data[i].toolName+"</option>")
		}
		
		$('#type').selectpicker({
	        dropupAuto:true,
	        liveSearch:true,
	        selectOnTab:true,
	        size:10,
	        liveSearchPlaceholder:"请输入关键字搜索",
	        width:"100%"
	    });
	});
}