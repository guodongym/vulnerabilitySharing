/**
 * Created by kingsir on 16/8/6.
 */

$(document).ready(function(){
    setType();
    setTime();
    setEditor();
    $("#saveTask").click(function(){
        if(checkData()){
        	var params = $('#saveTaskForm').serialize();
        	$.post(CTX+'/task/save', params, function(data) {
        		if (!data.error) {
                    swal({
                        title:"提示",
                        text: "保存成功",
                        type: "info",
                        showCancelButton: false,
                        confirmButtonText: "确定",
                        closeOnConfirm: true
                    },function(){
                        window.location.href=CTX+"/toMyTask";
                    })
        		} else {
        			swal(data.message);
        		}
        	});
        }
    });
    
    $("#saveAndReleaseTask").click(function(){
        if(checkData()){
        	var params = $('#saveTaskForm').serialize();
        	$.post(CTX+'/task/saveAndRelease', params, function(data) {
        		if (!data.error) {
                    swal({
                        title:"提示",
                        text: "保存并发布成功",
                        type: "info",
                        showCancelButton: false,
                        confirmButtonText: "确定",
                        closeOnConfirm: true
                    },function(){
                        window.location.href=CTX+"/toTaskList";
                    })
        		} else {
        			swal(data.message);
        		}
        	});
        }
    });
    
});

function setType(){
	$.post(CTX+'/taskType/findAll', {}, function(data) {
		for(var i=0;i<data.length;i++){
	        $("#taskType").append("<option value="+ data[i].id +">"+data[i].taskName+"</option>")
	    }
	    $('#taskType').selectpicker({
	        dropupAuto:true,
	        liveSearch:true,
	        selectOnTab:true,
	        size:5,
	        liveSearchPlaceholder:"请输入关键字搜索",
	        width:"50%"
	    });
	});
}

function setTime(){
    var dateConf={
        format: 'yyyy-mm-dd',
        autoclose: true,
        startDate: "2016-07-01",
        startView:2,
        minView:2,
        maxView:4,
        language:"zh-CN",
        bootcssVer:3
    }
    $("#taskEndTime").datetimepicker(dateConf);
}

function setEditor(){
    var editorConf={
        menus:editorMenuConf,
        uploadImgUrl:CTX+"/tool/uploadImage",
        hideLinkImg: true,
        menuFixed:false,
        uploadHeaders: {
            'Accept' : 'text/x-json'
        }
    }
	var editor = new wangEditor('taskRequirement');
    editor.config.menus=editorConf.menus;
    editor.config.uploadImgUrl=editorConf.uploadImgUrl;
    editor.config.uploadImgFileName = 'imageFile';
    editor.config.hideLinkImg=editorConf.hideLinkImg;
    editor.config.menuFixed=editorConf.menuFixed;
    editor.config.printLog = false;
    editor.create();
}