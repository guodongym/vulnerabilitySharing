$(document).ready(function(){
	
	$('#taskType').selectpicker({
        dropupAuto:true,
        liveSearch:true,
        selectOnTab:true,
        size:5,
        liveSearchPlaceholder:"请输入关键字搜索",
        width:"50%"
    });
	
	
	$("#taskEndTime").datetimepicker({
        format: 'yyyy-mm-dd',
        autoclose: true,
        startDate: "2016-07-01",
        startView:2,
        minView:2,
        maxView:4,
        language:"zh-CN",
        bootcssVer:3
    });
	
    setEditor();
    
    $("#saveTask").click(function(){
    	if(checkData()){
	    	var params = $('#updateTaskForm').serialize();
	    	$.post(CTX+'/task/doUpdate', params, function(data) {
	    		if (!data.error) {
                    swal({
                        title:"提示",
                        text: "保存成功",
                        type: "info",
                        showCancelButton: false,
                        confirmButtonText: "确定",
                        closeOnConfirm: true
                    },function(){
                        window.location.href=CTX+"/toMyTask";
                    })
	    		} else {
	    			swal(data.message);
	    		}
	    	});
    	}
    });
    
    $("#saveAndReleaseTask").click(function(){
    	if(checkData()){
	    	var params = $('#updateTaskForm').serialize();
	    	$.post(CTX+'/task/doUpdateAndRelease', params, function(data) {
	    		if (!data.error) {
	    			swal('保存并发布成功');
                    swal({
                        title:"提示",
                        text: "保存并发布成功",
                        type: "info",
                        showCancelButton: false,
                        confirmButtonText: "确定",
                        closeOnConfirm: true
                    },function(){
                        window.location.href=CTX+"/toTaskList";
                    })
	    		} else {
	    			swal(data.message);
	    		}
	    	});
    	}
    });
    
});


function setEditor(){
    var editorConf={
        menus:editorMenuConf,
        uploadImgUrl:CTX+"/tool/uploadImage",
        hideLinkImg: true,
        menuFixed:false,
        uploadHeaders: {
            'Accept' : 'text/x-json'
        }
    }
	var editor = new wangEditor('taskDemand');
    editor.config.menus=editorConf.menus;
    editor.config.uploadImgUrl=editorConf.uploadImgUrl;
    editor.config.uploadImgFileName = 'imageFile';
    editor.config.hideLinkImg=editorConf.hideLinkImg;
    editor.config.menuFixed=editorConf.menuFixed;
    editor.config.printLog = false;
    editor.create();
}