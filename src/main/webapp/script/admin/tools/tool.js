/**
 * Created by kingsir on 16/7/8.
 *
 * 包含一个aja请求
 */
window.operateEvents = {
    //删除按钮点击事件
    'click .remove': function (e, value, row, index) {
    	swal({
    		title:"删除工具",
    		text: "确定删除吗？",
    		type: "warning",
    		showCancelButton: true,
    		cancelButtonText:"取消",
    		CancelButtonColor: "#cccccc",
    		confirmButtonText: "确定",
    		closeOnConfirm: true
    	},function(){
    		deleteTool(row.toolId);
    	});
    }
};

function deleteTool(toolId){
	$.post(CTX+'/tool/deleteTool', {toolId:toolId}, function(data) {
		if (!data.error) {
			swal('删除成功');
			$('#tool_table').bootstrapTable('refresh');
		} else {
			swal(data.message);
		}
	});
	
}
//table_init
var tool_table={
	url:CTX+'/tool/findPage',
	pagination: true,
	pageList: [5,10,15,20],//可以选择一页显示 几行
	pageSize:5,//默认一页显示 几行
	pageNumber:1,//默认显示第几页
	sidePagination:'server',//设置为服务器端分页
	search: true,
	showRefresh: true,//刷新按钮
	striped: true,//是否循环变色
	toolbar:"#toolbar",
    columns:[{
        checkbox:true,
        width:"5%"
    },{
        field:"toolName",
        title:"工具名称",
        width:"60%",
        formatter:function(value,row,index){
            return '<a href="'+CTX+'/toUserInfo?userID='+row.id+'">'+row.toolName+'</a>'
        }
    },{
        field:"countToolComments",
        title:"评论数",
        width:"10%"
    },{
        field:"submitUserAccount",
        title:"发布人",
        width:"10%",
        formatter:function(value,row,index){
            return '<a href="'+CTX+'/toUserInfo?userID='+row.submitUserId+'">'+row.submitUserAccount+'</a>'
        }
    },{
        field:"haddle",
        title: '操作',
        width:"10%",
        align:"center",
        formatter:function(value,row,index){
            return [
                '<a class="remove" href="javascript:void(0)" title="删除">',
                '<i class="glyphicon glyphicon-trash"></i>',
                '</a>'
            ].join('');
        },
        events:'operateEvents'
    }]
};
$('#tool_table').bootstrapTable(tool_table);

$(document).ready(function(){
    //批量删除操作
    $("#delete_tool").click(function(){
        var selections=$('#tool_table').bootstrapTable('getAllSelections');
        if(selections.length<1){
            swal("提示", "请选择要删除的工具", "info");
            return;
        }
        
        swal({
    		title:"删除工具",
    		text: "确定要删除这些工具？",
    		type: "warning",
    		showCancelButton: true,
    		cancelButtonText:"取消",
    		CancelButtonColor: "#cccccc",
    		confirmButtonText: "确定",
    		closeOnConfirm: true
    	},function(){
    		 //批量删除工具
            deleteTools(selections)
    	});
       
    });
})
//删除该漏洞
function  deleteTools(selections){
	var idListString=[];
    for(var i=0;i<selections.length;i++){
    	idListString.push(selections[i].toolId);
    }
	//批量删除漏洞类型 
	$.post(CTX+'/tool/deleteTools',
			{ idListString:JSON.stringify(idListString)}, function(data) {
		if (!data.error) {
			swal('删除成功');
			$('#tool_table').bootstrapTable('refresh');
		} else {
			swal(data.message);
		}
	});

}

