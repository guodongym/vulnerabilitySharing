/**
 * Created by kingsir on 16/6/30.
 */
$(document).ready(function(){
    if($.cookie("BugShare")){
        $("#flag").attr("checked",true);
        $("#user").val($.cookie("username"));
        $("#password").val($.cookie("password"));
    }

    $("body").keydown(function() {
        if (event.keyCode == "13") {//keyCode=13是回车键
        	 $("#login").click();
        }
    });
    
    $("#login").click(function(){
        var user=$("#user").val();
        var password=$("#password").val();
        if(user.length<1){
            swal("请输入用户名");
            return
        }
        if(password.length<1){
            swal("请输入密码");
            return
        }
        $.ajax({
        	url:CTX + '/login.do', 
            type:"post",
            data:{
            	userAccount:user,
            	password:password
            },
            success:function(data){
                if(!data.error){
                	var flag=$("#flag").is(":checked");
                	if(flag){
    	                $.cookie("BugShare",true,{ expires: 7 });
    	                $.cookie("username",user,{ expires: 7 });
    	                $.cookie("password",password,{ expires: 7 });
    	            }else{
    	                $.removeCookie("BugShare");
    	                $.removeCookie("username");
    	                $.removeCookie("password");
    	            }
    	            //成功后跳转
    	            location.href= CTX + "/toHome";//前边不需要加"/",会自动加项目名
                }else{
                	swal(data.message);
                }
            },
            beforeSend: function(){
            	$("#login>span").html("正在登录中～～～");
            	$("#wating").show();
            },
            error:function(error){
                swal(error.status, "出错了!", "error");
                //显示出错信息
            }
        });
    });
});



