/**
 * Created by kingsir on 16/7/11.
 */
var bug_table={
	url:CTX+'/leak/findPageLeaks',
	pagination: true,
	pageList: [5,10,15,20],//可以选择一页显示 几行
	pageSize:5,//默认一页显示 几行
	pageNumber:1,//默认显示第几页
	sidePagination:'server',//设置为服务器端分页
	search: true,
	showRefresh: true,//刷新按钮
	striped: true,//是否循环变色
	toolbar:"#toolbar",
	toolbarAlign:"right",
	showPaginationSwitch:true,
    columns:[{
        field:"submitTime",
        title:"发布时间",
        width:"20%"
    },{
        field:"leakName",
        title:"漏洞标题",
        width:"40%",
        formatter:function(value,row,index){
            return '<a href="'+CTX+'/leak/idToLeak?leakId='+row.id+'">'+row.leakName+'</a>';
        }
    },{
        field:"leakStatus",
        title:"审核状态",
        width:"15%",
    },{
        field:"submitUserAccount",
        title:"发布人",
        width:"15%",
        formatter:function(value,row,index){
        	 return '<a href="'+CTX+'/toUserInfo?userID='+row.submitUserId+'">'+ row.submitUserAccount +'</a>';
        }
    }]
};
var table = $('#bug_table').bootstrapTable(bug_table);
//高级搜索
$(function(){
	$("#submitLeakSearch").click(function(){//submit
    	$('#searchModal').modal('hide');//searchModal
    	table.bootstrapTable('refresh',{
            query:{
            	search : '',
                likeKeyWord : $("#key").val(),//key
                leakTypeId : $("#leakTypeId").val(),//leakType
                leakRiskLevel : $("#level").val(),//level
                leakStatus : $("#status").val(),//status
                reviewStatus : $("#reviewStatus").val(),//reviewStatus审核结果
                createStarTime : $("#createStartTime").val(),//发布时间:
                createEndTime : $("#createEndTime").val(),//发布时间:
                reviewStartTime : $("#reviewStartTime").val(),//reviewStartTime
                reviewEndTime : $("#reviewEndTime").val()//reviewEndTime
                
            }
        });

    });
}) 

$(document).ready(function(){
    $("#status").change(function(){
        if(this.value=="3"){
            $("#reviewStartTime").val("");
            $("#reviewEndTime").val("");
            $("#review_status").show();
            $("#reviewTime").show();
        }else{
        	$("#reviewStatus").val("0");
        	$("#review_status").hide();
            $("#reviewTime").hide();
        }
    });
    var dateConf={
        format: 'yyyy-mm-dd',
        autoclose: true,
        startDate: "2016-07-01",
        startView:2,
        minView:2,
        maxView:4,
        language:"zh-CN",
        bootcssVer:3
    }
    $("#createStartTime").datetimepicker(dateConf);
    $("#createEndTime").datetimepicker(dateConf);
    $("#reviewStartTime").datetimepicker(dateConf);
    $("#reviewEndTime").datetimepicker(dateConf);
    
    setType();
});

function setType(){
	$.post(CTX+'/leakType/findAll', {}, function(data) {
		for(var i=0;i<data.length;i++){
			$("#leakTypeId").append("<option value="+ data[i].id +">"+data[i].leakName+"</option>")
		}
		$('#leakTypeId').selectpicker({
	        dropupAuto:true,
	        liveSearch:true,
	        selectOnTab:true,
	        size:10,
	        liveSearchPlaceholder:"请输入关键字搜索",
	        width:"100%"
	    });
	});
}