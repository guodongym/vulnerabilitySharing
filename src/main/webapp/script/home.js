/**
 * Created by kingsir on 16/7/4.
 */

$(document).ready(function(){
	var data={
        field:"submitTime",
        title:"发布时间",
        width:"20%"
    };
    var title={
        field:"leakName",
        title:"标题",
        width:"55%",
        formatter:function(value,row,index){
            return '<a target="_blank" href="'+CTX+'/leak/idToLeak?leakId='+row.id+'">'+row.leakName+'</a>';
        }
    };
    
    var comment={
        field:"leakCommentSum",
        title:"评论数",
        width:"15%",
        align:"center"
    };
    var author={
        field:"submitUserAccount",
        title:"发布人",
        width:"10%",
        align:"center",
        formatter:function(value,row,index){
            return '<a target="_blank" href="'+CTX+'/toUserInfo?userID='+row.submitUserId+'">'+row.submitUserAccount+'</a>';
        }
    };
    
    var newBugPublishTable=[];
    newBugPublishTable.push(data);
    newBugPublishTable.push(title);
    newBugPublishTable.push(comment);
    newBugPublishTable.push(author);
    //获取最新发布漏洞数据
    ajaxTableData("bug_new_table",newBugPublishTable, CTX+"/leak/getLatestReleaseLeak");

	    
    var newBugReviewTable=[];
    newBugReviewTable.push(data);
    newBugReviewTable.push(title);
    newBugReviewTable.push({
        field:"auditResult",
        title:"审核结果",
        width:"15%",
        align:"center"
    });
    newBugReviewTable.push({
        field:"auditUserAccount",
        title:"审核人",
        width:"10%",
        align:"center",
        formatter:function(value,row,index){
            return '<a target="_blank" href="'+CTX+'/toUserInfo?userID='+row.auditUserId+'">'+row.auditUserAccount+'</a>';
        }
    });
    //获取最新审核漏洞数据
    ajaxTableData("bug_new_review_table",newBugReviewTable,CTX + "/leak/getLatestAuditLeak");
    
    //获取最新发布工具数据
    var newToolPublishTable=[];
    newToolPublishTable.push({
        field:"createTime",
        title:"发布时间",
        width:"20%"
    });
    newToolPublishTable.push({
        field:"toolName",
        title:"标题",
        width:"55%",
        formatter:function(value,row,index){
            return '<a target="_blank" href="'+CTX+'/tool/toolDetail?toolId='+row.toolId+'">'+row.toolName+'</a>';
        }
    });
    newToolPublishTable.push({
        field:"sumComment",
        title:"评论数",
        width:"15%",
        align:"center"
    });
    newToolPublishTable.push({
        field:"submitUserAccount",
        title:"发布人",
        width:"10%",
        align:"center",
        formatter:function(value,row,index){
            return '<a target="_blank" href="'+CTX+'/toUserInfo?userID='+row.submitUserId+'">'+row.submitUserAccount+'</a>';
        }
    });
    ajaxTableData("tool_new_table",newToolPublishTable, CTX + "/tool/getLatestReleaseTool");
    
    
    
    //获取最新发布任务数据
    var newTaskPublishTable=[];
    newTaskPublishTable.push({
        field:"releaseTime",
        title:"发布时间",
        width:"20%"
    });
    newTaskPublishTable.push({
        field:"taskName",
        title:"标题",
        width:"50%",
        formatter:function(value,row,index){
            return '<a target="_blank" href="'+CTX+'/task/taskDetail?taskId='+row.taskId+'">'+row.taskName+'</a>';
        }
    });
    newTaskPublishTable.push({
        field:"taskNum",
        title:"限定人数",
        width:"10%",
        align:"center"
    });
    newTaskPublishTable.push({
        field:"taskScore",
        title:"任务积分",
        width:"10%",
        align:"center"
    });
    newTaskPublishTable.push({
        field:"releaseUserAccount",
        title:"发布人",
        width:"10%",
        align:"center",
        formatter:function(value,row,index){
            return '<a target="_blank" href="'+CTX+'/toUserInfo?userID='+row.releaseUserId+'">'+row.releaseUserAccount+'</a>';
        }
    });
    ajaxTableData("task_new_table",newTaskPublishTable,CTX + "/task/getLatestReleaseTask");
    
    
    
    var newCompleteTaskTable=[];
    newCompleteTaskTable.push({
        field:"taskFinishTime",
        title:"完成时间",
        width:"20%"
    });
    newCompleteTaskTable.push({
        field:"taskName",
        title:"标题",
        width:"60%",
        formatter:function(value,row,index){
            return '<a target="_blank" href="'+CTX+'/task/taskDetail?taskId='+row.taskId+'">'+row.taskName+'</a>';
        }
    });
    newCompleteTaskTable.push({
        field:"releaseUserAccount",
        title:"确认人",
        width:"10%",
        align:"center",
        formatter:function(value,row,index){
            return '<a target="_blank" href="'+CTX+'/toUserInfo?userID='+row.releaseUserId+'">'+row.releaseUserAccount+'</a>';
        }
    });
    ajaxTableData("task_complete_table",newCompleteTaskTable, CTX + "/task/getLatestFinishTask");
    
});

function ajaxTableData(id,conf,url){
    $.ajax({
        url:url,
        type:"post",
        dataType:'json',
        data:{
            pageSize:10
        },
        success:function(data){
            tableInit(id,data,conf);
        },
        error:function(XMLHttpRequest, textStatus, errorThrown){
            ajaxError(MLHttpRequest, textStatus, errorThrown);
        }
    });
}

function tableInit(id,data,columns){
    var conf={
        columns:columns,
        data:data,
        pagination:false,
        formatNoMatches: function () {
        	if(data.length==0){
        		return "没有找到匹配的记录";
        	}else{
                return data.message;
        	}
        }
    }
    $('#'+id).bootstrapTable(conf);
}